<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Family Member – Pastel UI Prototype</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Match the theme used by family_tree_ui_1_1.html -->
  <link rel="stylesheet" href="family_tree_theme_1_1.css">
  <script>
    tailwind.config = { theme: { extend: { fontFamily: { sans: ['Poppins','Inter','ui-sans-serif','system-ui'] } } } }
  </script>
  <style>
    /* Utilities aligned with family_tree_ui_1_1 theme */
    .panel{ background:var(--panel-bg,white); border:1px solid var(--panel-border,#e5e7eb); border-radius:16px; box-shadow:var(--panel-shadow,0 1px 2px rgb(0 0 0 / 0.06)); }
    .label{ display:block; margin-bottom:6px; font-size:14px; color:var(--neutral-700,#374151); font-weight:500; }
    .input{ width:100%; border:1px solid var(--neutral-200,#e5e7eb); border-radius:8px; padding:.5rem .75rem; outline:2px solid transparent; outline-offset:2px; background:var(--panel-bg,white); }
    .input:focus{ border-color:var(--primary,#0F62FE); box-shadow:0 0 0 2px color-mix(in oklch, var(--primary,#0F62FE), white 70%); }
    .btn{ height:40px; padding:0 .75rem; border-radius:8px; font-weight:600; display:inline-flex; align-items:center; justify-content:center; }
    .btn-sm{ height:32px; padding:0 .5rem; border-radius:8px; font-weight:600; display:inline-flex; align-items:center; justify-content:center; }
    .btn-press{ transition:transform .12s ease; }
    .btn-press:active{ transform:scale(.98); }
    .btn-outline{ background:white; border:1px solid var(--neutral-200,#e5e7eb); color:var(--neutral-800,#1f2937); }
    .btn-primary{ background:var(--primary,#0F62FE); color:var(--on-primary,white); }
    .btn-primary--gradient{ background:linear-gradient(90deg, color-mix(in oklch, var(--primary,#0F62FE), white 6%), var(--primary,#0F62FE)); color:white; }
    .badge{ display:inline-flex; align-items:center; gap:.375rem; background:color-mix(in oklch, var(--accent,#FF7EB6), white 85%); color:#1f2937; padding:.125rem .5rem; border-radius:6px; font-size:12px; }
    .u-chip--accent{ background:color-mix(in oklch, var(--accent,#FF7EB6), white 85%); color:#1f2937; }
    [data-accent="true"].border-t{ border-top-color:var(--accent,#FF7EB6) !important; }
    .icon-btn{ padding:.375rem; border-radius:8px; color:rgba(0,0,0,.6); }
    .icon-btn:focus-visible{ outline:2px solid var(--primary,#0F62FE); outline-offset:2px; }
    .field-error{ color:#b91c1c; font-size:13px; }
    .helper{ font-size:12px; color:var(--neutral-500,#6b7280); }
    .u-section-reveal{ opacity:0; transform:translateY(8px); transition:opacity .28s ease, transform .28s ease; }
    .u-section-reveal.is-visible{ opacity:1; transform:none; }
    .u-actions-sticky{ position:sticky; bottom:0; background:color-mix(in oklch, var(--panel-bg,white), white 6%); backdrop-filter:blur(6px); border-top:1px solid var(--neutral-100,#e5e7eb); }
  </style>
</head>
<body class="min-h-dvh bg-[color-mix(in_oklch,_#f8fafc,_#fff_40%)] text-[var(--ink,oklch(20%_0_0))]">

  <!-- Backdrop (always visible in this standalone UI) -->
  <div id="backdrop" class="fixed inset-0 bg-black/10 supports-[backdrop-filter]:bg-black/10 supports-[backdrop-filter]:backdrop-blur-sm z-0" aria-hidden="true"></div>

  <!-- Modal Dialog -->
  <section id="editMemberModal" class="relative z-10" role="dialog" aria-modal="true" aria-labelledby="dialog-title" aria-describedby="dialog-desc">
    <div class="flex items-center justify-center min-h-dvh p-2 sm:p-4">
      <!-- Sheet behavior on mobile -->
      <div class="panel relative w-full max-w-[896px] max-sm:h-[100dvh] max-sm:rounded-none overflow-hidden">
        <!-- Header with subtle accent bar -->
        <header class="relative px-4 sm:px-6 py-4 border-b border-[color:var(--neutral-100,#e5e7eb)]">
          <span aria-hidden="true" class="absolute left-0 top-0 h-full w-1 u-header-accent--gradient"></span>
          <div class="flex items-start sm:items-center gap-3">
            <div class="flex-1">
              <h2 id="dialog-title" class="text-lg sm:text-xl font-semibold">Edit Family Member</h2>
              <p id="dialog-desc" class="text-[12px] opacity-70 mt-1">Update details for an existing member. Mirrors the in‑app Edit experience (including canvas fields).</p>
            </div>
            <button id="closeModal" class="icon-btn" aria-label="Close">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
            </button>
          </div>
        </header>

        <!-- Content -->
        <div class="px-4 sm:px-6 py-4 max-h-[calc(100dvh-8rem)] overflow-y-auto">
          <form id="memberForm" class="space-y-8 text-[color:var(--neutral-900,#111827)]" novalidate>
            <!-- Global error (server) -->
            <div id="globalError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md" role="alert"></div>

            <!-- Basic Information -->
            <section aria-labelledby="section-basic" class="pt-1 u-section-reveal">
              <div class="mb-3">
                <div class="flex items-center justify-between">
                  <h3 id="section-basic" class="text-base font-medium flex items-center gap-2">
                    <span aria-hidden="true" class="text-[color:var(--info,#0F62FE)]">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4"><path fill-rule="evenodd" d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11H9v-2h2v2zm0-4H9V5h2v4z" clip-rule="evenodd"/></svg>
                    </span>
                    Basic Information
                  </h3>
                  <span class="inline-flex items-center gap-1 rounded-md px-2 py-0.5 text-[12px] u-chip--accent" aria-hidden="true">Required</span>
                </div>
                <div class="mt-3 border-t" data-accent="true"></div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="name" class="label">Name *</label>
                  <input id="name" name="name" type="text" class="input" placeholder="Enter full name" aria-invalid="false" aria-describedby="name-error" value="John Doe">
                  <p id="name-error" class="field-error hidden" role="alert"></p>
                </div>
                <div>
                  <label for="gender" class="label">Gender</label>
                  <select id="gender" name="gender" class="input">
                    <option value="male">Male</option>
                    <option value="female">Female</option>
                    <option value="other">Other</option>
                  </select>
                </div>
                <div>
                  <label for="relationship" class="label">Relationship *</label>
                  <select id="relationship" name="relationship" class="input" aria-invalid="false" aria-describedby="relationship-error">
                    <option value="">Select relationship</option>
                    <option>Father</option>
                    <option>Mother</option>
                    <option>Son</option>
                    <option>Daughter</option>
                    <option>Brother</option>
                    <option>Sister</option>
                    <option>Grandfather</option>
                    <option>Grandmother</option>
                    <option>Grandson</option>
                    <option>Granddaughter</option>
                    <option>Uncle</option>
                    <option>Aunt</option>
                    <option>Nephew</option>
                    <option>Niece</option>
                    <option>Cousin</option>
                    <option>Spouse</option>
                    <option>Other</option>
                  </select>
                  <p id="relationship-error" class="field-error hidden" role="alert"></p>
                </div>
                <div>
                  <label for="title" class="label">Title/Occupation</label>
                  <input id="title" name="title" type="text" class="input" placeholder="e.g., Engineer, Teacher" value="Engineer" />
                </div>
              </div>
            </section>

            <!-- Dates -->
            <section aria-labelledby="section-dates" class="border-t pt-4 u-section-reveal">
              <div class="mb-3">
                <h3 id="section-dates" class="text-base font-medium flex items-center gap-2">
                  <span aria-hidden="true" class="text-[color:var(--info,#0F62FE)]">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4"><path d="M6 2a1 1 0 011 1v1h6V3a1 1 0 112 0v1h1a2 2 0 012 2v9a2 2 0 01-2 2H3a2 2 0 01-2-2V6a2 2 0 012-2h1V3a1 1 0 112 0v1zm11 7H3v6h14V9z"/></svg>
                  </span>
                  Dates
                </h3>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="birthDate" class="label">Birth Date</label>
                  <input id="birthDate" name="birthDate" type="date" class="input" aria-invalid="false" aria-describedby="birthDate-error" value="1990-01-15">
                  <p id="birthDate-error" class="field-error hidden" role="alert"></p>
                </div>
                <div>
                  <label for="deathDate" class="label">Death Date</label>
                  <input id="deathDate" name="deathDate" type="date" class="input" aria-invalid="false" aria-describedby="deathDate-error">
                  <p id="deathDate-error" class="field-error hidden" role="alert"></p>
                </div>
              </div>
            </section>

            <!-- Photo -->
            <section aria-labelledby="section-photo" class="border-t pt-4 u-section-reveal">
              <div class="mb-3">
                <h3 id="section-photo" class="text-base font-medium flex items-center gap-2">
                  <span aria-hidden="true" class="text-[color:var(--info,#0F62FE)]">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4"><path d="M4 5a2 2 0 00-2 2v7a2 2 0 002 2h12a2 2 0 002-2V7a2 2 0 00-2-2h-2.586l-1-1H7.586l-1 1H4zm6 3a4 4 0 110 8 4 4 0 010-8z"/></svg>
                  </span>
                  Photo
                </h3>
              </div>
              <label for="photo" class="sr-only">Photo</label>
              <div class="flex items-center gap-4">
                <input id="photo" type="file" accept="image/*" class="hidden" />
                <button type="button" id="photoButton" class="btn btn-outline btn-press">Change Photo</button>
                <div id="photoPreviewWrap" class="relative hidden">
                  <img id="photoPreview" alt="Preview" class="w-16 h-16 rounded-full object-cover" />
                  <button type="button" id="removePhoto" class="absolute -top-2 -right-2 rounded-full w-6 h-6 flex items-center justify-center text-white text-xs bg-red-500" aria-label="Remove photo">×</button>
                </div>
              </div>
              <p id="photo-error" class="field-error hidden mt-1" role="alert"></p>
            </section>

            <!-- Contact -->
            <section aria-labelledby="section-contact" class="border-t pt-4 u-section-reveal">
              <div class="mb-3 flex items-center justify-between">
                <h3 id="section-contact" class="text-base font-medium flex items-center gap-2">
                  <span aria-hidden="true" class="text-[color:var(--info,#0F62FE)]">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4"><path d="M2 3a1 1 0 011-1h3l2 3h6a1 1 0 011 1v2H2V3zM2 10h18v4a1 1 0 01-1 1H3a1 1 0 01-1-1v-4z"/></svg>
                  </span>
                  Contact
                </h3>
                <span class="badge">Optional</span>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="email" class="label">Email</label>
                  <input id="email" name="email" type="email" class="input" placeholder="email@example.com" aria-invalid="false" aria-describedby="email-error" value="john@example.com">
                  <p id="email-error" class="field-error hidden" role="alert"></p>
                </div>
                <div>
                  <label for="phone" class="label">Phone</label>
                  <input id="phone" name="phone" type="tel" class="input" placeholder="+1 (555) 123-4567" aria-invalid="false" aria-describedby="phone-error" value="+1 (555) 987-6543">
                  <p id="phone-error" class="field-error hidden" role="alert"></p>
                </div>
              </div>
              <div class="mt-4">
                <label for="address" class="label">Address</label>
                <input id="address" name="address" type="text" class="input" placeholder="Full address" value="123 Main St, Springfield, IL">
              </div>
            </section>

            <!-- Relations -->
            <section aria-labelledby="section-relations" class="border-t pt-4 u-section-reveal">
              <div class="mb-3">
                <h3 id="section-relations" class="text-base font-medium flex items-center gap-2">
                  <span aria-hidden="true" class="text-[color:var(--info,#0F62FE)]">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4"><path fill-rule="evenodd" d="M10 2a3 3 0 100 6 3 3 0 000-6zM2 16a6 6 0 1112 0v2H2v-2z" clip-rule="evenodd"/></svg>
                  </span>
                  Relations
                </h3>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label for="parentId" class="label">Parent</label>
                  <select id="parentId" name="parentId" class="input" aria-invalid="false" aria-describedby="parentId-error">
                    <option value="">Select parent</option>
                    <option value="m2">Jane Doe (Mother)</option>
                    <option value="m3">Robert Smith (Father)</option>
                  </select>
                  <p id="parentId-error" class="field-error hidden" role="alert"></p>
                </div>
                <div>
                  <label for="spouseIds" class="label">Spouses <span class="helper">(Hold Ctrl/Cmd to select multiple)</span></label>
                  <select id="spouseIds" name="spouseIds" multiple size="3" class="input" aria-invalid="false" aria-describedby="spouseIds-error">
                    <option value="m4">Mary Johnson (Spouse)</option>
                    <option value="m5">Alex Brown (Spouse)</option>
                    <option value="m6">Chris Lee (Spouse)</option>
                  </select>
                  <p id="spouseIds-error" class="field-error hidden" role="alert"></p>
                </div>
              </div>
            </section>

            <!-- Biography -->
            <section aria-labelledby="section-bio" class="border-t pt-4 u-section-reveal">
              <div class="mb-3">
                <h3 id="section-bio" class="text-base font-medium flex items-center gap-2">
                  <span aria-hidden="true" class="text-[color:var(--info,#0F62FE)]">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4"><path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h11a1 1 0 000-2H5a1 1 0 010-2h10V5a2 2 0 00-2-2H4z"/></svg>
                  </span>
                  Biography
                </h3>
              </div>
              <label for="biography" class="label">Biography <span class="ms-2 text-[12px] opacity-60">(<span id="bioCount">0</span>/1000 characters)</span></label>
              <textarea id="biography" name="biography" rows="3" maxlength="1000" class="input resize-y" placeholder="Brief biography or notes…">Short bio goes here.</textarea>
              <p id="biography-error" class="field-error hidden" role="alert"></p>
            </section>

            <!-- Canvas Position & Size (Edit only) -->
            <section aria-labelledby="section-canvas" class="border-t pt-4 u-section-reveal">
              <div class="mb-3">
                <h3 id="section-canvas" class="text-base font-medium flex items-center gap-2">
                  <span aria-hidden="true" class="text-[color:var(--info,#0F62FE)]">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-4 w-4"><path d="M4 4h12v12H4zM7 7h6v6H7z"/></svg>
                  </span>
                  Canvas Position & Size
                </h3>
              </div>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                  <label for="posX" class="label">X Position</label>
                  <input id="posX" name="posX" type="number" class="input" aria-invalid="false" aria-describedby="posX-error" value="100">
                  <p id="posX-error" class="field-error hidden" role="alert"></p>
                </div>
                <div>
                  <label for="posY" class="label">Y Position</label>
                  <input id="posY" name="posY" type="number" class="input" aria-invalid="false" aria-describedby="posY-error" value="100">
                  <p id="posY-error" class="field-error hidden" role="alert"></p>
                </div>
                <div>
                  <label for="sizeWidth" class="label">Width</label>
                  <input id="sizeWidth" name="sizeWidth" type="number" class="input" aria-invalid="false" aria-describedby="sizeWidth-error" value="200" min="50">
                  <p id="sizeWidth-error" class="field-error hidden" role="alert"></p>
                </div>
                <div>
                  <label for="sizeHeight" class="label">Height</label>
                  <input id="sizeHeight" name="sizeHeight" type="number" class="input" aria-invalid="false" aria-describedby="sizeHeight-error" value="120" min="30">
                  <p id="sizeHeight-error" class="field-error hidden" role="alert"></p>
                </div>
              </div>
              <p class="helper mt-1">Must be positive; width ≥ 50px and height ≥ 30px.</p>
            </section>

            <!-- Actions (sticky inside scroll area) -->
            <div class="u-actions-sticky flex justify-end gap-2 sm:gap-3 pt-4 pb-3 mt-6">
              <button type="button" id="cancelBtn" class="btn btn-outline btn-press">Cancel</button>
              <button type="submit" id="submitBtn" class="btn btn-primary btn-primary--gradient btn-press">Update Member</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </section>

  <!-- Scripts: icons + components -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/flowbite@2.0.0/dist/flowbite.min.js"></script>

  <script>
    (function(){
      const modal = document.getElementById('editMemberModal');
      const backdrop = document.getElementById('backdrop');
      const closer = document.getElementById('closeModal');
      const cancelBtn = document.getElementById('cancelBtn');
      const form = document.getElementById('memberForm');
      const submitBtn = document.getElementById('submitBtn');

      // Simulated current member id for validation
      const currentMemberId = 'member-123';

      function close(){ /* no-op for standalone preview */ }
      closer && closer.addEventListener('click', close);
      cancelBtn && cancelBtn.addEventListener('click', close);

      // Photo controls
      const photoInput = document.getElementById('photo');
      const photoButton = document.getElementById('photoButton');
      const photoPreviewWrap = document.getElementById('photoPreviewWrap');
      const photoPreview = document.getElementById('photoPreview');
      const removePhoto = document.getElementById('removePhoto');
      const photoError = document.getElementById('photo-error');

      photoButton.addEventListener('click', () => photoInput.click());
      photoInput.addEventListener('change', () => {
        const file = photoInput.files && photoInput.files[0];
        photoError.classList.add('hidden'); photoError.textContent='';
        if (!file) return;
        if (!file.type.startsWith('image/')) { photoError.textContent='Please select a valid image file'; photoError.classList.remove('hidden'); return; }
        if (file.size > 5 * 1024 * 1024) { photoError.textContent='File size must be less than 5MB'; photoError.classList.remove('hidden'); return; }
        const reader = new FileReader();
        reader.onload = (e) => { photoPreview.src = e.target.result; photoPreviewWrap.classList.remove('hidden'); };
        reader.readAsDataURL(file);
      });
      removePhoto.addEventListener('click', () => { photoInput.value = ''; photoPreview.src=''; photoPreviewWrap.classList.add('hidden'); });

      // Section reveal on scroll
      const revealObserver = new IntersectionObserver((entries) => {
        for (const entry of entries){
          if (entry.isIntersecting){ entry.target.classList.add('is-visible'); revealObserver.unobserve(entry.target); }
        }
      }, { threshold: 0.06 });
      document.querySelectorAll('.u-section-reveal').forEach(el => revealObserver.observe(el));

      // Biography char count
      const bio = document.getElementById('biography');
      const bioCount = document.getElementById('bioCount');
      bioCount.textContent = String(bio.value.length);
      bio.addEventListener('input', () => { bioCount.textContent = String(bio.value.length); });

      // Utilities
      function setFieldError(id, message){
        const input = document.getElementById(id);
        const err = document.getElementById(id+'-error');
        if (!err || !input) return;
        if (message){
          input.setAttribute('aria-invalid','true');
          err.textContent = message;
          err.classList.remove('hidden');
        } else {
          input.setAttribute('aria-invalid','false');
          err.textContent = '';
          err.classList.add('hidden');
        }
      }

      function getMultiSelectValues(selectEl){
        return Array.from(selectEl.selectedOptions).map(o => o.value);
      }

      // Client-side validation mirroring app rules (edit mode)
      form.addEventListener('submit', (e) => {
        e.preventDefault();
        submitBtn.disabled = true; submitBtn.textContent = 'Updating…';
        let hasError = false;

        const name = document.getElementById('name').value.trim();
        if (!name) { setFieldError('name','Name is required'); hasError = true; } else if (name.length < 2) { setFieldError('name','Name must be at least 2 characters long'); hasError = true; } else if (name.length > 100) { setFieldError('name','Name must be less than 100 characters'); hasError = true; } else { setFieldError('name',''); }

        const relationship = document.getElementById('relationship').value.trim();
        if (!relationship) { setFieldError('relationship','Relationship is required'); hasError = true; } else { setFieldError('relationship',''); }

        const email = document.getElementById('email').value.trim();
        if (email && !/^([^\s@]+)@([^\s@]+)\.[^\s@]+$/.test(email)) { setFieldError('email','Please enter a valid email address'); hasError = true; } else { setFieldError('email',''); }

        const phone = document.getElementById('phone').value.trim();
        if (phone){
          const phoneOk = /^[\d\s+()-]+$/.test(phone) && phone.replace(/[\s+()-]/g,'').length >= 7;
          if (!phoneOk) { setFieldError('phone','Please enter a valid phone number (digits, spaces, +, -, () only)'); hasError = true; } else { setFieldError('phone',''); }
        } else { setFieldError('phone',''); }

        const birth = document.getElementById('birthDate').value;
        const death = document.getElementById('deathDate').value;
        if (birth && death){
          const b = new Date(birth); const d = new Date(death);
          if (d <= b) { setFieldError('deathDate','Death date must be after birth date'); hasError = true; } else { setFieldError('deathDate',''); }
        } else { setFieldError('deathDate',''); }
        if (birth){
          const b = new Date(birth); const today = new Date(); if (b > today) { setFieldError('birthDate','Birth date cannot be in the future'); hasError = true; } else { setFieldError('birthDate',''); }
        } else { setFieldError('birthDate',''); }

        const bioVal = bio.value || '';
        if (bioVal.length > 1000){ setFieldError('biography','Biography must be less than 1000 characters'); hasError = true; } else { setFieldError('biography',''); }

        // Edit-only validations
        const posX = parseInt(document.getElementById('posX').value || '0', 10);
        const posY = parseInt(document.getElementById('posY').value || '0', 10);
        if (isNaN(posX) || posX < 0 || isNaN(posY) || posY < 0){
          document.getElementById('posX-error').textContent = 'Position coordinates must be positive numbers';
          document.getElementById('posX-error').classList.remove('hidden');
          hasError = true;
        } else {
          document.getElementById('posX-error').textContent = '';
          document.getElementById('posX-error').classList.add('hidden');
          document.getElementById('posY-error').textContent = '';
          document.getElementById('posY-error').classList.add('hidden');
        }
        const w = parseInt(document.getElementById('sizeWidth').value || '0', 10);
        const h = parseInt(document.getElementById('sizeHeight').value || '0', 10);
        if (isNaN(w) || isNaN(h) || w < 50 || h < 30){
          document.getElementById('sizeWidth-error').textContent = 'Size must be at least 50x30 pixels';
          document.getElementById('sizeWidth-error').classList.remove('hidden');
          hasError = true;
        } else {
          document.getElementById('sizeWidth-error').textContent = '';
          document.getElementById('sizeWidth-error').classList.add('hidden');
          document.getElementById('sizeHeight-error').textContent = '';
          document.getElementById('sizeHeight-error').classList.add('hidden');
        }

        // Relations: cannot relate to self
        const parentId = document.getElementById('parentId').value;
        const spouses = getMultiSelectValues(document.getElementById('spouseIds'));
        if (parentId && parentId === currentMemberId){ setFieldError('parentId','A member cannot be their own parent'); hasError = true; } else { setFieldError('parentId',''); }
        if (spouses.includes(currentMemberId)){ setFieldError('spouseIds','A member cannot be their own spouse'); hasError = true; } else { setFieldError('spouseIds',''); }

        if (hasError){ submitBtn.disabled = false; submitBtn.textContent = 'Update Member'; return; }

        // Demo: Close on success
        setTimeout(() => { submitBtn.disabled = false; submitBtn.textContent = 'Update Member'; close(); }, 600);
      });
    })();
  </script>
</body>
</html>
